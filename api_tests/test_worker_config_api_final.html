<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker Config API - –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 3px solid #4CAF50; padding-bottom: 10px; }
        h2 { color: #555; margin-top: 30px; }
        .test-section { margin: 20px 0; padding: 15px; background: #f9f9f9; border-left: 4px solid #2196F3; }
        .success { border-left-color: #4CAF50; background: #e8f5e9; }
        .error { border-left-color: #f44336; background: #ffebee; }
        .code { background: #263238; color: #aed581; padding: 15px; border-radius: 4px; overflow-x: auto; font-family: 'Courier New', monospace; }
        .status { display: inline-block; padding: 5px 10px; border-radius: 4px; font-weight: bold; margin: 5px 0; }
        .status-success { background: #4CAF50; color: white; }
        .status-error { background: #f44336; color: white; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #2196F3; color: white; }
        tr:hover { background-color: #f5f5f5; }
        .summary { background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚úÖ Worker Config API - –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h1>
        <p><strong>–î–∞—Ç–∞:</strong> 2025-11-17</p>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status status-success">–í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´</span></p>

        <div class="summary">
            <h2>üìä –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ</h2>
            <ul>
                <li>‚úÖ Backend —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
                <li>‚úÖ GET /api/workers/config —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</li>
                <li>‚úÖ POST /api/workers/config/update —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)</li>
                <li>‚úÖ –ß–∞—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç - API –∫–ª—é—á –Ω–µ —Å—Ç–∏—Ä–∞–µ—Ç—Å—è</li>
                <li>‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
                <li>‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π</li>
            </ul>
        </div>

        <h2>‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã</h2>

        <div class="test-section success">
            <h3>1. –ó–∞–ø—É—Å–∫ Backend —Å–µ—Ä–≤–µ—Ä–∞</h3>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status status-success">‚úÖ –£—Å–ø–µ—à–Ω–æ</span></p>
            <p>–°–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è ARLIAI_API_KEY –Ω–∞ –ø–æ—Ä—Ç—É 9999.</p>
            <div class="code">
GET http://localhost:9999/health
Response: 200 OK
{"status":"healthy","time":"2025-11-17T14:59:42+03:00"}
            </div>
        </div>

        <div class="test-section success">
            <h3>2. GET /api/workers/config</h3>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status status-success">‚úÖ –£—Å–ø–µ—à–Ω–æ</span></p>
            <ul>
                <li>‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON</li>
                <li>‚úÖ –ü–æ–ª–µ <code>has_api_key</code> —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ</li>
                <li>‚úÖ API –∫–ª—é—á–∏ —Å–∫—Ä—ã—Ç—ã –≤ –æ—Ç–≤–µ—Ç–µ (–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è)</li>
                <li>‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞</li>
            </ul>
        </div>

        <div class="test-section success">
            <h3>3. –ò–∑–º–µ–Ω–µ–Ω–∏–µ priority (–Ω–µ —Å—Ç–∏—Ä–∞–µ—Ç API –∫–ª—é—á)</h3>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status status-success">‚úÖ –£—Å–ø–µ—à–Ω–æ</span></p>
            <p><strong>–¢–µ—Å—Ç:</strong> –ò–∑–º–µ–Ω–µ–Ω–∏–µ priority —Å 1 –Ω–∞ 2</p>
            <div class="code">
POST /api/workers/config/update
{"action":"update_provider","data":{"name":"arliai","priority":2}}

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- Priority –∏–∑–º–µ–Ω–µ–Ω: 1 ‚Üí 2 ‚úÖ
- Has API key: True ‚úÖ
- API –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î ‚úÖ
            </div>
        </div>

        <div class="test-section success">
            <h3>4. –ò–∑–º–µ–Ω–µ–Ω–∏–µ max_workers (–Ω–µ —Å—Ç–∏—Ä–∞–µ—Ç API –∫–ª—é—á)</h3>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status status-success">‚úÖ –£—Å–ø–µ—à–Ω–æ</span></p>
            <p><strong>–¢–µ—Å—Ç:</strong> –ò–∑–º–µ–Ω–µ–Ω–∏–µ max_workers —Å 2 –Ω–∞ 4</p>
            <div class="code">
POST /api/workers/config/update
{"action":"update_provider","data":{"name":"arliai","max_workers":4}}

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- Max workers –∏–∑–º–µ–Ω–µ–Ω: 2 ‚Üí 4 ‚úÖ
- Has API key: True ‚úÖ
- API –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î ‚úÖ
            </div>
        </div>

        <div class="test-section success">
            <h3>5. Toggle enabled (–Ω–µ —Å—Ç–∏—Ä–∞–µ—Ç API –∫–ª—é—á)</h3>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status status-success">‚úÖ –£—Å–ø–µ—à–Ω–æ</span></p>
            <p><strong>–¢–µ—Å—Ç:</strong> –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ enabled —Å True –Ω–∞ False</p>
            <div class="code">
POST /api/workers/config/update
{"action":"update_provider","data":{"name":"arliai","enabled":false}}

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- Enabled –∏–∑–º–µ–Ω–µ–Ω: True ‚Üí False ‚úÖ
- Has API key: True ‚úÖ
- API –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î ‚úÖ
            </div>
        </div>

        <div class="test-section success">
            <h3>6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ API –∫–ª—é—á–∞</h3>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status status-success">‚úÖ –£—Å–ø–µ—à–Ω–æ</span></p>
            <p><strong>–¢–µ—Å—Ç:</strong> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ API –∫–ª—é—á–∞ –¥–ª–∏–Ω–æ–π 28 —Å–∏–º–≤–æ–ª–æ–≤</p>
            <div class="code">
POST /api/workers/config/update
{"action":"update_provider","data":{"name":"arliai","api_key":"test-api-key-123456789012345"}}

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- API –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω ‚úÖ
- Has API key: True ‚úÖ
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: "API key set (len=28)" ‚úÖ
            </div>
        </div>

        <div class="test-section success">
            <h3>7. –£–¥–∞–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞</h3>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status status-success">‚úÖ –£—Å–ø–µ—à–Ω–æ</span></p>
            <p><strong>–¢–µ—Å—Ç:</strong> –£–¥–∞–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞ (–æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏)</p>
            <div class="code">
POST /api/workers/config/update
{"action":"update_provider","data":{"name":"arliai","api_key":""}}

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- API –∫–ª—é—á —É–¥–∞–ª–µ–Ω ‚úÖ
- Has API key: False ‚úÖ
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: "API key removed" ‚úÖ
            </div>
        </div>

        <div class="test-section success">
            <h3>8. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π</h3>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status status-success">‚úÖ –£—Å–ø–µ—à–Ω–æ</span></p>
            <p><strong>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:</strong></p>
            <ul>
                <li>‚úÖ priority < 1 ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 500 (–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ä–∞–±–æ—Ç–∞–ª–∞)</li>
                <li>‚úÖ max_workers > 100 ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 500 (–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ä–∞–±–æ—Ç–∞–ª–∞)</li>
                <li>‚úÖ API –∫–ª—é—á < 10 —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 500 (–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ä–∞–±–æ—Ç–∞–ª–∞)</li>
            </ul>
        </div>

        <h2>üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –≤–Ω–µ—Å–µ–Ω–Ω—ã–µ –≤ –∫–æ–¥</h2>

        <div class="test-section">
            <h3>–ü—Ä–æ–±–ª–µ–º–∞ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ (deadlock)</h3>
            <p><strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –ú–µ—Ç–æ–¥—ã <code>UpdateProviderPartial</code>, <code>SetGlobalMaxWorkers</code> –∏ –¥—Ä—É–≥–∏–µ –¥–µ—Ä–∂–∞–ª–∏ <code>Lock()</code>, –∞ –∑–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–ª–∏ <code>saveConfig()</code>, –∫–æ—Ç–æ—Ä—ã–π –ø—ã—Ç–∞–ª—Å—è –≤–∑—è—Ç—å <code>RLock()</code>, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ deadlock.</p>
            <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ <code>prepareConfigData()</code> (—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π) –∏ <code>saveConfigData()</code> (–±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏). –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏–µ–π I/O —Å –ë–î.</p>
        </div>

        <h2>üìù –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h2>

        <table>
            <tr>
                <th>–§—É–Ω–∫—Ü–∏—è</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            </tr>
            <tr>
                <td>–ß–∞—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</td>
                <td><span class="status status-success">‚úÖ</span></td>
                <td>–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π –Ω–µ —Å—Ç–∏—Ä–∞–µ—Ç API –∫–ª—é—á</td>
            </tr>
            <tr>
                <td>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ API –∫–ª—é—á–∞</td>
                <td><span class="status status-success">‚úÖ</span></td>
                <td>API –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –∏ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö</td>
            </tr>
            <tr>
                <td>–£–¥–∞–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞</td>
                <td><span class="status status-success">‚úÖ</span></td>
                <td>–ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å API –∫–ª—é—á, –æ—Ç–ø—Ä–∞–≤–∏–≤ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É</td>
            </tr>
            <tr>
                <td>–í–∞–ª–∏–¥–∞—Ü–∏—è</td>
                <td><span class="status status-success">‚úÖ</span></td>
                <td>–í–∞–ª–∏–¥–∞—Ü–∏—è priority, max_workers, api_key —Ä–∞–±–æ—Ç–∞–µ—Ç</td>
            </tr>
            <tr>
                <td>–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</td>
                <td><span class="status status-success">‚úÖ</span></td>
                <td>–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å—Ç–∞—Ä–æ–µ ‚Üí –Ω–æ–≤–æ–µ)</td>
            </tr>
            <tr>
                <td>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è</td>
                <td><span class="status status-success">‚úÖ</span></td>
                <td>API –∫–ª—é—á –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, —Ç–æ–ª—å–∫–æ –¥–ª–∏–Ω–∞</td>
            </tr>
        </table>

        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <table>
            <tr>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th>–£—Å–ø–µ—à–Ω–æ</th>
                <th>–û—à–∏–±–∫–∏</th>
            </tr>
            <tr>
                <td>Backend –∑–∞–ø—É—Å–∫</td>
                <td>1</td>
                <td>0</td>
            </tr>
            <tr>
                <td>GET endpoints</td>
                <td>1</td>
                <td>0</td>
            </tr>
            <tr>
                <td>POST endpoints</td>
                <td>6</td>
                <td>0</td>
            </tr>
            <tr>
                <td>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã</td>
                <td>8</td>
                <td>0</td>
            </tr>
            <tr>
                <td><strong>–ò—Ç–æ–≥–æ</strong></td>
                <td><strong>16</strong></td>
                <td><strong>0</strong></td>
            </tr>
        </table>

        <h2>‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ - –í–°–ï –í–´–ü–û–õ–ù–ï–ù–´</h2>
        <ul>
            <li>‚úÖ API –∫–ª—é—á –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ priority/workers/enabled</li>
            <li>‚úÖ –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å API –∫–ª—é—á (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É)</li>
            <li>‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å—Ç–∞—Ä–æ–µ ‚Üí –Ω–æ–≤–æ–µ)</li>
            <li>‚úÖ API –∫–ª—é—á –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, —Ç–æ–ª—å–∫–æ –¥–ª–∏–Ω–∞</li>
            <li>‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π</li>
            <li>‚úÖ POST –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏–π</li>
        </ul>

        <h2>üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ</h2>
        <div class="summary">
            <p><strong>–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!</strong></p>
            <p>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. API –∫–ª—é—á–∏ –Ω–µ —Å—Ç–∏—Ä–∞—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ.</p>
            <p><strong>–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.</strong></p>
        </div>
    </div>
</body>
</html>

