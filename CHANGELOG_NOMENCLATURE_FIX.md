# Changelog: Исправление фильтрации номенклатур

## [Исправлено] - 2024-11-27

### Проблема
В системе показывались только нормализованные номенклатуры (1 штука), хотя в базе данных было больше номенклатур. Базы данных, содержащие таблицу `normalized_data`, полностью пропускались при обработке.

### Решение
Удалена проверка на наличие таблицы `normalized_data`, которая пропускала базы данных полностью. Теперь все базы обрабатываются независимо от наличия этой таблицы.

### Изменения

#### Backend
- **server/handlers/clients.go**: Удалена проверка на `normalized_data` в методе `GetClientNomenclature`
- **server/client_legacy_handlers.go**: Удалена аналогичная проверка в двух местах

#### Тестирование
- **server/handlers/clients_nomenclature_test.go**: Добавлен тест `TestGetClientNomenclature_ShowsAllNomenclatures`
  - Проверяет получение данных из всех источников
  - Подтверждает, что базы с `normalized_data` не пропускаются
  - Тест проходит успешно (получает 7 элементов из всех источников)

#### Утилиты
- **tools/check_nomenclature_count.go**: Добавлена утилита для проверки количества номенклатур
  - Показывает разбивку по источникам (нормализованные vs исходные)
  - Поддерживает фильтрацию по клиенту и проекту
  - Выводит детальную информацию при использовании флага `-details`

#### Документация
- **docs/NOMENCLATURE_FIX_SUMMARY.md**: Итоговый отчет по исправлению
- **docs/NOMENCLATURE_FIX_VERIFICATION.md**: Инструкции по проверке исправления
- **tools/README_nomenclature_check.md**: Документация по утилите
- **tools/USAGE_nomenclature_check.md**: Краткая инструкция по использованию

### Результат

**До исправления:**
- Показывались только нормализованные номенклатуры из `normalized_data.db` (1 штука)
- Базы с таблицей `normalized_data` полностью пропускались

**После исправления:**
- Показываются **все** номенклатуры:
  - Нормализованные из `normalized_data.db`
  - Исходные из баз проектов (включая базы с таблицей `normalized_data`)

### Тестирование

Тест `TestGetClientNomenclature_ShowsAllNomenclatures` проходит успешно:
- Получает 7 элементов из всех источников
- Подтверждает обработку баз с `normalized_data`
- Стабильно работает (проверено 3 раза подряд)

### Обратная совместимость

✅ Изменения полностью обратно совместимы  
✅ Не влияют на существующий функционал  
✅ Улучшают поведение системы  

### Миграция

Миграция не требуется. Изменения применяются автоматически при обновлении кода.

### Проверка

Для проверки исправления:
1. Запустите тест: `go test ./server/handlers -run TestGetClientNomenclature_ShowsAllNomenclatures`
2. Используйте утилиту: `./tools/check_nomenclature_count.exe -db "путь/к/базе.db" -client 1 -details`
3. Проверьте в интерфейсе, что отображаются все номенклатуры

