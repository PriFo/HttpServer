# Исправление ошибки подключения к Backend серверу

## Проблема

Ошибка в консоли браузера:
```
Не удалось подключиться к backend серверу. Убедитесь, что сервер запущен на порту 9999.
```

## Причина

Backend сервер не был запущен на порту 9999.

## Решение

### 1. Запуск Backend сервера

#### Вариант A: Использование скомпилированного exe (рекомендуется, быстрее)

```batch
start-backend-exe.bat
```

Этот скрипт:
- ✅ Проверяет, не запущен ли уже backend
- ✅ Использует скомпилированный `httpserver_no_gui.exe` если доступен
- ✅ Запускает сервер в фоновом режиме
- ✅ Проверяет, что сервер отвечает на запросы

#### Вариант B: Использование go run

```batch
start-backend.bat
```

Этот скрипт:
- ✅ Проверяет наличие Go
- ✅ Проверяет, не запущен ли уже backend
- ✅ Запускает сервер через `go run`

### 2. Проверка статуса Backend

```batch
check-backend-status.bat
```

Этот скрипт проверяет:
- Занят ли порт 9999
- Отвечает ли сервер на health check запросы

### 3. Исправление логики API запросов

Исправлен файл `frontend/lib/api-utils.ts`:
- Пути, начинающиеся с `/api/`, теперь обрабатываются как Next.js API routes (относительные пути)
- Это позволяет Next.js API routes корректно проксировать запросы к backend серверу

## Проверка работы

1. **Проверка Backend:**
   ```bash
   curl http://localhost:9999/health
   ```
   Должен вернуть: `{"status":"healthy","time":"..."}`

2. **Проверка Frontend API routes:**
   ```bash
   curl http://localhost:3000/api/dashboard/stats
   ```
   Должен вернуть данные статистики

3. **Проверка в браузере:**
   - Откройте http://localhost:3000
   - Dashboard должен загрузиться без ошибок
   - Данные должны отображаться корректно

## Автоматический запуск обоих серверов

```batch
start-all.bat
```

Этот скрипт запускает:
- Backend на порту 9999
- Frontend на порту 3000

## Устранение проблем

### Backend не запускается

1. Проверьте, что порт 9999 свободен:
   ```bash
   netstat -ano | findstr :9999
   ```

2. Проверьте наличие Go (для go run):
   ```bash
   go version
   ```

3. Проверьте наличие скомпилированного exe:
   ```bash
   dir httpserver_no_gui.exe
   ```

### Backend запущен, но не отвечает

1. Проверьте health endpoint:
   ```bash
   curl http://localhost:9999/health
   ```

2. Проверьте логи в окне сервера

3. Перезапустите backend:
   ```batch
   check-backend-status.bat
   start-backend-exe.bat
   ```

## Измененные файлы

1. `frontend/lib/api-utils.ts` - исправлена логика обработки API путей
2. `start-backend.bat` - добавлена проверка занятости порта
3. `start-backend-exe.bat` - новый скрипт для запуска через exe
4. `check-backend-status.bat` - новый скрипт для проверки статуса

## Дата исправления

21 ноября 2025
