# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "Unexpected end of multipart data"

**–î–∞—Ç–∞:** 2025-11-26  
**–ü—Ä–æ–±–ª–µ–º–∞:** `Error: Unexpected end of multipart data` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**

---

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ UI –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
Error: Unexpected end of multipart data
(An unexpected error occurred while processing the request. Please check the server logs for more information.)
```

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ multipart —Ñ–æ—Ä–º–∞ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–∞–Ω–∞ –∏–ª–∏ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–¥–∞—á–∏.

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ multipart –≤ backend

**–§–∞–π–ª:** `server/client_legacy_handlers.go`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `Content-Length` –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 500MB)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ multipart
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è "Unexpected end of multipart data"
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å requestID

**–ö–æ–¥:**
```go
// –ü—Ä–æ–≤–µ—Ä—è–µ–º Content-Length –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º
contentLengthStr := r.Header.Get("Content-Length")
var contentLength int64
if contentLengthStr != "" {
    if parsedLen, err := strconv.ParseInt(contentLengthStr, 10, 64); err == nil {
        contentLength = parsedLen
        log.Printf("[handleUploadProjectDatabase] [%s] Content-Length: %d –±–∞–π—Ç (~%.2f MB)", 
            requestID, contentLength, float64(contentLength)/(1024*1024))
    }
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º
maxSize := int64(500 << 20) // 500MB
if contentLength > 0 && contentLength > maxSize {
    log.Printf("[handleUploadProjectDatabase] [%s] –û—à–∏–±–∫–∞: —Ñ–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π", requestID)
    s.writeJSONError(w, r, fmt.Sprintf("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: %d –±–∞–π—Ç", contentLength), 
        http.StatusRequestEntityTooLarge)
    return
}

// –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è "Unexpected end of multipart data"
err = r.ParseMultipartForm(500 << 20)
if err != nil {
    if strings.Contains(err.Error(), "Unexpected end") || strings.Contains(err.Error(), "multipart data") {
        log.Printf("[handleUploadProjectDatabase] [%s] –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ 'Unexpected end of multipart data'", requestID)
        log.Printf("[handleUploadProjectDatabase] [%s] –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:", requestID)
        log.Printf("[handleUploadProjectDatabase] [%s]   1. –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–¥–∞—á–∏", requestID)
        log.Printf("[handleUploadProjectDatabase] [%s]   2. –¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞", requestID)
        log.Printf("[handleUploadProjectDatabase] [%s]   3. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ Next.js", requestID)
        log.Printf("[handleUploadProjectDatabase] [%s]   4. –§–∞–π–ª –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–∞–Ω", requestID)
        
        s.writeJSONError(w, r, 
            fmt.Sprintf("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ —Ñ–∞–π–ª–∞: —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –∏–ª–∏ —Ñ–∞–π–ª –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–∞–Ω. "+
                "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å–Ω–æ–≤–∞ –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞. –î–µ—Ç–∞–ª–∏: %v", err), 
            http.StatusBadRequest)
    }
    return
}
```

### 2. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ FormData –≤ frontend

**–§–∞–π–ª:** `frontend/app/api/clients/[clientId]/projects/[projectId]/databases/route.ts`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Blob` –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (15 –º–∏–Ω—É—Ç –¥–ª—è —Ñ–∞–π–ª–æ–≤ > 100MB)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–µ–¥–∞—á–∏

**–ö–æ–¥:**
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ –ø—É—Å—Ç–æ–π
if (file.size === 0) {
    console.error(`[API Route] [${requestID}] ‚ùå File is empty: ${file.name}`)
    return NextResponse.json(
        { error: `File "${file.name}" is empty. Please select a valid file.` },
        { status: 400 }
    )
}

// –ò—Å–ø–æ–ª—å–∑—É–µ–º Blob –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏
const fileBlob = new Blob([await file.arrayBuffer()], { type: file.type })
backendFormData.append(key, fileBlob, file.name)

// –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
const timeoutMs = totalSize > 100 * 1024 * 1024 ? 15 * 60 * 1000 : 10 * 60 * 1000
```

---

## üìä –ü—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏ "Unexpected end of multipart data"

### 1. **–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–¥–∞—á–∏**
- **–°–∏–º–ø—Ç–æ–º:** –§–∞–π–ª –±–æ–ª—å—à–æ–π, –ø–µ—Ä–µ–¥–∞—á–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- **–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–æ 15 –º–∏–Ω—É—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### 2. **–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞**
- **–°–∏–º–ø—Ç–æ–º:** –§–∞–π–ª > 100MB, —Ç–∞–π–º–∞—É—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
- **–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞

### 3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ Next.js**
- **–°–∏–º–ø—Ç–æ–º:** FormData –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è, —Ç–µ—Ä—è–µ—Ç—Å—è —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- **–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Blob –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏

### 4. **–§–∞–π–ª –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–∞–Ω**
- **–°–∏–º–ø—Ç–æ–º:** –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ
- **–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend

–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å `[handleUploadProjectDatabase]`:
```
[handleUploadProjectDatabase] [req_xxx] Content-Length: 12345678 –±–∞–π—Ç (~11.77 MB)
[handleUploadProjectDatabase] [req_xxx] –ù–∞—á–∞–ª–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ multipart —Ñ–æ—Ä–º—ã
[handleUploadProjectDatabase] [req_xxx] ‚ùå –û–®–ò–ë–ö–ê –ø–∞—Ä—Å–∏–Ω–≥–∞ multipart —Ñ–æ—Ä–º—ã: ...
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ frontend

–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å `[API Route]`:
```
[API Route] [req_xxx] FormData prepared: 1 file(s), 2 field(s), total size: 12345678 bytes
[API Route] [req_xxx] üì§ Sending request to backend (timeout: 600s)...
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞

- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: **500MB**
- –ï—Å–ª–∏ —Ñ–∞–π–ª –±–æ–ª—å—à–µ, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –æ—à–∏–±–∫—É `413 Request Entity Too Large`

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ü–æ—Å–ª–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **–ö–æ–º–ø–∏–ª—è—Ü–∏—è:**
   ```powershell
   go build ./cmd/server
   ```
   ‚úÖ –£—Å–ø–µ—à–Ω–æ

2. **–ó–∞–ø—É—Å–∫:**
   ```powershell
   .\start-backend.ps1
   ```
   ‚úÖ Backend –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ–±–æ–ª—å—à—É—é –ë–î (< 10MB)
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ä–µ–¥–Ω—é—é –ë–î (10-100MB)
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend –∏ frontend –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç—å backend:** `.\start-backend.ps1`
2. ‚úÖ **–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ë–î** —á–µ—Ä–µ–∑ UI
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** backend –∏ frontend
4. ‚úÖ **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 500MB)
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –Ω–∞–ø—Ä—è–º—É—é –≤ backend (–º–∏–Ω—É—è Next.js proxy)

---

## üìù –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –†–µ—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ Next.js –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è, –º–æ–∂–Ω–æ:

1. **–ó–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é –≤ backend:**
   - –ò–∑–º–µ–Ω–∏—Ç—å frontend, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ `http://localhost:9999`
   - –û–±–æ–π—Ç–∏ Next.js API route –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å chunked upload:**
   - –†–∞–∑–±–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ —á–∞—Å—Ç–∏
   - –ó–∞–≥—Ä—É–∂–∞—Ç—å —á–∞—Å—Ç–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
   - –°–æ–±—Ä–∞—Ç—å —Ñ–∞–π–ª –Ω–∞ backend

---

## üìÑ –°–≤—è–∑–∞–Ω–Ω—ã–µ –§–∞–π–ª—ã

- `server/client_legacy_handlers.go` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ multipart –≤ backend
- `frontend/app/api/clients/[clientId]/projects/[projectId]/databases/route.ts` - –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Next.js
- `500_ERROR_FIX_SUMMARY.md` - –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

**–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!** ‚úÖ

Backend —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É multipart –¥–∞–Ω–Ω—ã—Ö –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º.

