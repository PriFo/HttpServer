# üèóÔ∏è –û—Ç—á–µ—Ç –æ–± —É–ª—É—á—à–µ–Ω–∏—è—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–î–∞—Ç–∞:** 2025-11-21  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø –ù–ê–ß–ê–¢–´**

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `server/services/normalization_service.go` - —Å–µ—Ä–≤–∏—Å –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã
- `server/services/counterparty_service.go` - —Å–µ—Ä–≤–∏—Å –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤

#### NormalizationService

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ (`IsRunning`, `Start`, `Stop`)
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ (`GetStatus`)
- –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (`CreateStopCheck`)
- –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç HTTP handlers
- –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å - —Å–µ—Ä–≤–∏—Å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ - –ª–æ–≥–∏–∫—É –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö

#### CounterpartyService

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
- –ï–¥–∏–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤
- –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π:
```
Handler ‚Üí Database (–Ω–∞–ø—Ä—è–º—É—é)
Handler ‚Üí Business Logic (–≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ handler)
```

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:
```
Handler ‚Üí Service ‚Üí Database
Handler ‚Üí Service ‚Üí Business Logic
```

---

## üîç –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### NormalizationService

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```go
type NormalizationService struct {
    db                *database.DB
    serviceDB         *database.ServiceDB
    normalizer        *normalization.Normalizer
    normalizerMutex   sync.RWMutex
    normalizerRunning bool
    normalizerStartTime time.Time
    normalizerProcessed int
    normalizerSuccess   int
    normalizerErrors    int
    normalizerEvents    chan<- string
    normalizerCtx       interface{}
    normalizerCancel   func()
}
```

**–ú–µ—Ç–æ–¥—ã:**
- `IsRunning() bool` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- `Start() error` - –∑–∞–ø—É—Å–∫ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- `Stop() bool` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- `GetStatus() NormalizationStatus` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
- `CreateStopCheck() func() bool` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

### CounterpartyService

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```go
type CounterpartyService struct {
    serviceDB         *database.ServiceDB
    normalizerMutex   sync.RWMutex
    normalizerRunning bool
    normalizerEvents  chan<- string
    normalizerCtx     interface{}
    normalizerCancel  func()
}
```

**–ú–µ—Ç–æ–¥—ã:**
- `IsRunning() bool` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- `Start() error` - –∑–∞–ø—É—Å–∫ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- `Stop() bool` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- `CreateStopCheck() func() bool` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
- `CreateNormalizer(...) *CounterpartyNormalizer` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä–∞

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Server

**–ó–∞–¥–∞—á–∏:**
- –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `Server`
- –û–±–Ω–æ–≤–∏—Ç—å handlers –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏–∑ handlers –≤ —Å–µ—Ä–≤–∏—Å—ã

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–Ω–æ–≥–æ —Å–ª–æ—è

**–ó–∞–¥–∞—á–∏:**
- –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- –í—ã–Ω–µ—Å—Ç–∏ SQL –∑–∞–ø—Ä–æ—Å—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –ë–î –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö

### 3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ handlers

**–ó–∞–¥–∞—á–∏:**
- –í—ã–Ω–µ—Å—Ç–∏ handlers –∏–∑ `server.go` –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å handlers –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å handlers (—Ç–æ–ª—å–∫–æ HTTP –æ–±—Ä–∞–±–æ—Ç–∫–∞)

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
   - Handlers - —Ç–æ–ª—å–∫–æ HTTP –æ–±—Ä–∞–±–æ—Ç–∫–∞
   - Services - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
   - Repositories - —Ä–∞–±–æ—Ç–∞ —Å –ë–î

2. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**
   - –°–µ—Ä–≤–∏—Å—ã –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
   - –õ–µ–≥–∫–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
   - –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**
   - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç
   - –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö handlers
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞

4. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**
   - –õ–µ–≥—á–µ –Ω–∞–π—Ç–∏ –∏ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É
   - –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
   - –ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:
- `server/services/normalization_service.go`
- `server/services/counterparty_service.go`

### –§—É–Ω–∫—Ü–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–æ:
- 5 –º–µ—Ç–æ–¥–æ–≤ –≤ NormalizationService
- 5 –º–µ—Ç–æ–¥–æ–≤ –≤ CounterpartyService

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Server
- –ú–∏–≥—Ä–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π —Å–æ–∑–¥–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. –≠—Ç–æ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ —É–ª—É—á—à–µ–Ω–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –º–∏–≥—Ä–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏–∑ handlers.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–°–ï–†–í–ò–°–ù–´–ô –°–õ–û–ô –°–û–ó–î–ê–ù, –ì–û–¢–û–í –ö –ò–ù–¢–ï–ì–†–ê–¶–ò–ò**

