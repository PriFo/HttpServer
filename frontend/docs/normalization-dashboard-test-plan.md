# План тестирования дашборда нормализации НСИ

Документ служит чек-листом для регресса после последних изменений по управлению состоянием проектов, контексту и общей API-абстракции.

## 1. Переключение проектов
- Открыть страницу клиента с несколькими проектами и последовательно выбрать 3–4 проекта.
- Убедиться, что `NormalizationStatsSummary`, `QuickStats`, `ProcessMonitoringWorkspace`, `NormalizationResultsTable`, `NotificationCenter`, `ChangeHistory`, `ActivityTimeline` и `PipelineVisualization` полностью сбрасываются и не отображают данные предыдущего проекта.
- Проверить URL-параметры (`page`, `search`, `sort`) в `NormalizationResultsTable` — должны сбрасываться при смене проекта.
- На время переключения убедиться, что в Network нет запросов к старому `projectId` (AbortController срабатывает).

## 2. Отсутствие выбранного проекта
- Зайти на страницу клиента без `projectId` или открыть проект, который был удалён.
- Все зависящие компоненты должны показать дружелюбную заглушку («выберите проект»), без ошибок в консоли и без проброса `undefined` в API.

## 3. Мониторинг и автообновление
- Запустить процесс нормализации (кнопка `Запустить` в QuickActions).
- Убедиться, что:
  - `ProcessMonitoringWorkspace` обновляется каждые 5 секунд, статус отображается с пульсацией.
  - `NormalizationStatsSummary` переключается на автообновление (30 сек).
  - `PipelineVisualization` корректно показывает текущий этап.
- Остановить процесс — убедиться, что автообновление выключилось (последний сет запросов более не повторяется).

## 4. Нотификации, история, активность
- Перейти на вкладку Monitoring и выполнить действия, генерирующие события (старт/стоп процесса, экспорт, изменение настроек).
- Проверить:
  - `NotificationCenter` получает новые уведомления, кнопки «отметить как прочитанное/все прочитаны» работают.
  - `ChangeHistory` фиксирует действия с привязкой к правильным entityId.
  - `ActivityTimeline` фильтрует по типам и позволяет включать/выключать автообновление, при ручном обновлении не показывает ошибок.

## 5. Таблица результатов и атрибуты
- В `NormalizationResultsTable` развернуть несколько групп, убедиться, что атрибуты подгружаются и отображаются через `AttributesDisplay`.
- Применить поиск, фильтр по категории, проверять пагинацию. URL-параметры должны синхронизироваться.
- Переключиться на другой проект и убедиться, что все фильтры и раскрытые группы сбрасываются.

## 6. Дедупликация и бизнес-правила
- На вкладке Deduplication изменить порог схожести, убедиться в обновлении списка кластеров и отсутствии дублирующих запросов.
- Выполнить действия «merge/separate/exclude» и проверить, что состояние синхронно обновляется (refetch вызывается один раз).
- В `BusinessRulesManager` создать/отредактировать/удалить правило. Проверить, что диалог закрывается, список обновляется и в истории появляется запись.

## 7. Экспорт и настройки
- Инициировать экспорт через `ExportManager`: диалог должен показывать states `onExportStart`/`onExportComplete`, список экспортов обновляется после завершения.
- В `SettingsPanel` изменить параметр, сохранить — убедиться, что данные привязаны к конкретному проекту и не смешиваются.

## 8. Глобальный поиск и help
- Использовать `GlobalSearch` с несколькими запросами, убедиться в дебаунсе и отсутствии лишних запросов при очистке поля.
- Проверить `HelpPanel`: поиск по темам работает, быстрые действия открывают верные ссылки.

## 9. Производительность и ошибки
- Включить DevTools Performance/Network и проверить, что при быстром переключении проектов старые запросы отменяются (`(canceled)`).
- Протестировать режим офлайн/500 на бэкенде: убедиться, что каждый компонент показывает `ErrorState` с кнопкой «Повторить».

## 10. Smoke-тест сборки
- `npm run lint` — без ошибок.
- `npm run build` — успешная сборка Next.js.
- E2E/интеграционные тесты (если доступны) — прогнать для сценариев запуска/остановки процесса и изменения правил.

