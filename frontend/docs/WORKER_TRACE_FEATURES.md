# –§—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã `/internal/worker-trace`.

## üìä –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–æ—Ç–æ–∫—É —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏

- **SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** –∫ `/api/internal/worker-trace/stream?trace_id=...`
- **Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** —à–∞–≥–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** trace_id –≤ –∏—Å—Ç–æ—Ä–∏—é

### 2. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

#### Gantt-–¥–∏–∞–≥—Ä–∞–º–º–∞
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —à–∞–≥–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—è–º –ª–æ–≥–æ–≤ (INFO, WARNING, ERROR)
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π tooltip —Å –¥–µ—Ç–∞–ª—è–º–∏ —à–∞–≥–∞

#### –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞
- –•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —à–∞–≥–æ–≤
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞—É–∑ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏
- –ò–∫–æ–Ω–∫–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º –ª–æ–≥–æ–≤

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤
- –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ —à–∞–≥
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ —É—Ä–æ–≤–Ω—è–º –ª–æ–≥–æ–≤
- –°–∞–º—ã–π –¥–æ–ª–≥–∏–π –∏ –∫–æ—Ä–æ—Ç–∫–∏–π —à–∞–≥–∏
- –í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏

#### –§–∏–ª—å—Ç—Ä—ã
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—è–º: –í—Å–µ, INFO, WARNING, ERROR
- –ü–æ–∏—Å–∫ –≤ —Å–ø–∏—Å–∫–µ —à–∞–≥–æ–≤

#### –≠–∫—Å–ø–æ—Ä—Ç
- **JSON** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å–µ—Ö —à–∞–≥–∞—Ö
- **CSV** - —Ç–∞–±–ª–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

#### –ò—Å—Ç–æ—Ä–∏—è trace_id
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö trace_id
- –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
- –ü–æ–∏—Å–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏
- –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π

### 4. –î–µ—Ç–∞–ª–∏ —à–∞–≥–∞

–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
- ID —à–∞–≥–∞ –∏ trace_id
- –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ (–Ω–∞—á–∞–ª–æ/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)
- –°–æ–æ–±—â–µ–Ω–∏–µ
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (JSON)

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- `WorkerTraceGantt` - –¥–∏–∞–≥—Ä–∞–º–º–∞ –ì–∞–Ω—Ç–∞
- `WorkerTraceTimeline` - –≤—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞
- `WorkerTraceStats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `WorkerTraceDetails` - –¥–µ—Ç–∞–ª–∏ —à–∞–≥–∞ (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ)
- `TraceIDHistory` - –∏—Å—Ç–æ—Ä–∏—è trace_id

### –•—É–∫–∏

- `useTraceHistory()` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π trace_id
- `useSSE()` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ö—É–∫ –¥–ª—è SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

```typescript
interface WorkerTraceStep {
  id: string
  trace_id: string
  step: string
  start_time: number
  end_time?: number
  duration?: number
  level: 'INFO' | 'WARNING' | 'ERROR'
  message: string
  metadata?: Record<string, unknown>
}
```

## üìù –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```tsx
// –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ worker-trace
import { WorkerTraceStats } from '@/components/internal/worker-trace-stats'
import { TraceIDHistory } from '@/components/internal/trace-id-history'

<TraceIDHistory onSelectTraceId={setTraceId} />
<WorkerTraceStats steps={steps} />
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é `admin`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ middleware –∏ layout
- –ó–∞—â–∏—Ç–∞ SSE —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º

Backend —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/internal/worker-trace/stream`:
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `trace_id` –∫–∞–∫ query –ø–∞—Ä–∞–º–µ—Ç—Ä
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ SSE
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç heartbeat –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –±—ç–∫–µ–Ω–¥–∞:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏–º–µ–Ω –ø–æ–ª–µ–π (camelCase –∏ PascalCase)
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
- –í–∞–ª–∏–¥–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π –ª–æ–≥–æ–≤

## üé® –ê–Ω–∏–º–∞—Ü–∏–∏

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç AnimationProvider –¥–ª—è:
- –ü–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- Stagger –∞–Ω–∏–º–∞—Ü–∏–π –¥–ª—è —Å–ø–∏—Å–∫–æ–≤
- Hover —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- –£—á–µ—Ç–∞ `prefers-reduced-motion`

## üíæ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

–ò—Å—Ç–æ—Ä–∏—è trace_id —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `localStorage`:
- –ö–ª—é—á: `worker-trace-history`
- –ú–∞–∫—Å–∏–º—É–º 20 –∑–∞–ø–∏—Å–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:
- –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏: 3 —Å–µ–∫—É–Ω–¥—ã
- –ü–æ–∫–∞–∑ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫

## üìà –ú–µ—Ç—Ä–∏–∫–∏

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤
- –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–æ—Ç –ø–µ—Ä–≤–æ–≥–æ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —à–∞–≥–∞)
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ —à–∞–≥
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º –ª–æ–≥–æ–≤
- –°–∞–º—ã–π –¥–æ–ª–≥–∏–π –∏ –∫–æ—Ä–æ—Ç–∫–∏–π —à–∞–≥–∏

