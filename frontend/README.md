# Frontend - Нормализатор данных 1С

Веб-интерфейс для управления процессом нормализации данных номенклатуры.

## Технологии

- Next.js 16 (App Router)
- TypeScript
- Tailwind CSS
- shadcn/ui компоненты
- Server-Sent Events (SSE) для реального времени

## Установка

```bash
npm install
```

## Запуск

```bash
npm run dev
```

Приложение будет доступно по адресу http://localhost:3000

## Настройка

По умолчанию фронтенд подключается к бэкенду на `http://localhost:9999`.

Для изменения адреса бэкенда создайте файл `.env.local`:

```
BACKEND_URL=http://localhost:9999
```

## Структура

- `app/page.tsx` - главная страница
- `app/normalization/page.tsx` - страница нормализации
- `app/api/normalization/*` - API роуты для прокси к Go бэкенду
- `components/ui/*` - shadcn/ui компоненты
- `components/normalization/*` - компоненты для нормализации

## Функции

### Основные возможности
- Запуск/остановка процесса нормализации
- Мониторинг прогресса в реальном времени через SSE
- Отображение логов выполнения
- Статистика по категориям и группам
- Управление клиентами и проектами
- Анализ качества данных

### Новые возможности (обновлено 2025)

#### Мониторинг AI-провайдеров (`/monitoring`)
- **Реальное время**: Отслеживание метрик провайдеров через Server-Sent Events
- **Управление провайдерами**: Запуск и остановка отдельных AI-провайдеров (OpenRouter, Hugging Face, Arliai, Eden AI, DaData, Adata.kz)
- **Управление воркерами KPVED**: Контроль воркеров классификации КПВЭД
- **Визуализация**: Графики производительности, статистика запросов, латентность
- **Метрики системы**: Общая статистика по всем провайдерам

#### Отчеты (`/reports`)
- **Отчет по нормализации**: Полный анализ процесса нормализации данных
  - Общая статистика (контрагенты, номенклатура, дубликаты)
  - Анализ контрагентов и номенклатуры
  - Производительность провайдеров
  - Разбивка по базам данных
  - Рекомендации по улучшению
- **Отчет о качестве данных**: Детальный анализ качества данных
  - Общий score качества
  - Статистика по контрагентам и номенклатуре
  - Анализ полноты и уникальности данных
  - Выявление несоответствий
  - Рекомендации
- **Экспорт в PDF**: Скачивание отчетов в формате PDF

#### Улучшенный статус нормализации
- **Информация о провайдерах**: Отображение использованных AI-провайдеров с детальной статистикой
  - Цветовая индикация по типу провайдера (DaData, Adata.kz, OpenRouter, Hugging Face, Arliai, Eden AI)
  - Количество запросов к каждому провайдеру
  - Процент успешных запросов с визуальной индикацией (Отлично/Хорошо/Требует внимания)
  - Описание использования провайдеров (обогащение данных vs генеративные AI)
- **Метрики провайдеров**: Количество запросов, процент успешных запросов
- **Оптимистичные обновления**: Мгновенное обновление UI при действиях пользователя

#### SEO оптимизация
- **Метаданные для всех страниц**: Динамические title и description
- **Структурированные данные (JSON-LD)**: Для лучшего понимания контента поисковыми системами
- **Sitemap**: Автоматическая генерация карты сайта с приоритетами
- **Robots.txt**: Правильная настройка индексации (запрет /api/* и /monitoring)

## Тестирование

### E2E тесты (Playwright)

Установка зависимостей:
```bash
npm install --save-dev @playwright/test
npx playwright install
```

Запуск тестов:
```bash
# Запуск всех тестов
npx playwright test

# Запуск тестов для конкретной страницы
npx playwright test tests/e2e/monitoring.spec.ts
npx playwright test tests/e2e/reports.spec.ts

# Запуск в UI режиме
npx playwright test --ui

# Запуск в режиме отладки
npx playwright test --debug
```

Просмотр отчета:
```bash
npx playwright show-report
```

### Компонентные тесты

Для компонентных тестов рекомендуется использовать React Testing Library:
```bash
npm install --save-dev @testing-library/react @testing-library/jest-dom jest jest-environment-jsdom
```

Подробная документация по тестированию: [tests/README.md](./tests/README.md)

## SEO оптимизация

Приложение полностью оптимизировано для поисковых систем:

- **Метаданные**: Динамические title и description для каждой страницы
- **Structured Data (JSON-LD)**: Структурированные данные для лучшего понимания контента поисковыми системами
- **Robots.txt**: Правильная настройка индексации
- **Sitemap.xml**: Автоматическая генерация карты сайта
- **Open Graph**: Поддержка метатегов для социальных сетей

## UX улучшения

- **Skeleton компоненты**: Плавная загрузка контента вместо простых индикаторов
- **Оптимистичные обновления**: Мгновенное обновление UI при действиях пользователя
- **Обработка ошибок**: Все ошибки отображаются через toast-уведомления (sonner)
- **Адаптивный дизайн**: Полная поддержка мобильных устройств

## Дополнительная документация

- [USER_GUIDE.md](./USER_GUIDE.md) - Подробное руководство пользователя
- [tests/README.md](./tests/README.md) - Документация по тестированию
