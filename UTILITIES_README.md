# Утилиты для управления системой

## Скрипты запуска

### Windows Batch (.bat)

#### `start-backend-exe.bat`
Быстрый запуск backend через скомпилированный exe файл.
- ✅ Проверяет занятость порта перед запуском
- ✅ Использует exe для быстрого старта
- ✅ Автоматически проверяет health endpoint

**Использование:**
```batch
start-backend-exe.bat
```

#### `start-backend.bat`
Запуск backend через `go run`.
- ✅ Проверяет наличие Go
- ✅ Проверяет занятость порта
- ✅ Устанавливает переменные окружения

**Использование:**
```batch
start-backend.bat
```

#### `check-backend-status.bat`
Проверка статуса backend сервера.
- ✅ Проверяет занятость порта 9999
- ✅ Тестирует health endpoint
- ✅ Показывает подробную информацию

**Использование:**
```batch
check-backend-status.bat
```

#### `start-all.bat`
Запуск обоих серверов (backend + frontend).
- ✅ Запускает backend на порту 9999
- ✅ Запускает frontend на порту 3000
- ✅ Открывает оба сервера в отдельных окнах

**Использование:**
```batch
start-all.bat
```

## PowerShell скрипты (.ps1)

### `quick-check.ps1`
Быстрая проверка состояния всей системы.
- ✅ Проверяет статус backend (порт 9999)
- ✅ Проверяет статус frontend (порт 3000)
- ✅ Проверяет API endpoints
- ✅ Показывает информацию о портах

**Использование:**
```powershell
powershell -ExecutionPolicy Bypass -File .\quick-check.ps1
```

**Пример вывода:**
```
========================================
Быстрая проверка системы
========================================

Backend (порт 9999):
  ✓ Работает
  Статус: healthy
  API /api/clients: ✓ (3 клиентов)

Frontend (порт 3000):
  ✓ Работает
  API /api/dashboard/stats: ✓

Порты:
  Порт 9999: ✓ Занят (PID: 15832)
  Порт 3000: ✓ Занят (PID: 38292)
```

### `monitor-backend.ps1`
Мониторинг backend сервера с автоматическим перезапуском.
- ✅ Периодически проверяет health endpoint
- ✅ Автоматически перезапускает при сбое (опционально)
- ✅ Логирует все события
- ✅ Настраиваемые параметры

**Использование:**
```powershell
# Только мониторинг (без автоперезапуска)
powershell -ExecutionPolicy Bypass -File .\monitor-backend.ps1

# С автоматическим перезапуском
powershell -ExecutionPolicy Bypass -File .\monitor-backend.ps1 -AutoRestart

# С настройками
powershell -ExecutionPolicy Bypass -File .\monitor-backend.ps1 -CheckInterval 60 -MaxFailures 5 -AutoRestart
```

**Параметры:**
- `-CheckInterval <секунды>` - Интервал проверки (по умолчанию: 30)
- `-MaxFailures <число>` - Максимум неудачных проверок перед перезапуском (по умолчанию: 3)
- `-AutoRestart` - Включить автоматический перезапуск при сбое

**Пример вывода:**
```
========================================
Мониторинг Backend сервера
========================================

Интервал проверки: 30 секунд
Максимум неудач: 3
Автоперезапуск: Включен

[13:10:00] ✓ Backend работает нормально
[13:10:30] ✓ Backend работает нормально
[13:11:00] ✗ Backend не отвечает (попытка 1/3)
[13:11:30] ✗ Backend не отвечает (попытка 2/3)
[13:12:00] ✗ Backend не отвечает (попытка 3/3)
[13:12:00] Перезапуск backend сервера...
[13:12:03] Backend сервер успешно запущен
```

## Рекомендации по использованию

### Для разработки:
1. Используйте `start-all.bat` для запуска обоих серверов
2. Используйте `check-backend-status.bat` для быстрой проверки

### Для продакшена:
1. Используйте `start-backend-exe.bat` для быстрого запуска
2. Используйте `monitor-backend.ps1 -AutoRestart` для автоматического мониторинга
3. Используйте `quick-check.ps1` для периодической проверки состояния

### Для отладки:
1. Используйте `check-backend-status.bat` для проверки статуса
2. Используйте `quick-check.ps1` для полной диагностики
3. Проверяйте логи в окнах серверов

## Устранение проблем

### Backend не запускается
1. Проверьте порт: `check-backend-status.bat`
2. Проверьте наличие exe: `dir httpserver_no_gui.exe`
3. Проверьте логи в окне сервера

### Frontend не подключается к backend
1. Запустите `quick-check.ps1` для диагностики
2. Проверьте, что backend отвечает: `curl http://localhost:9999/health`
3. Проверьте переменные окружения

### Автоматический перезапуск не работает
1. Убедитесь, что используется флаг `-AutoRestart`
2. Проверьте права доступа к файлу `httpserver_no_gui.exe`
3. Проверьте логи мониторинга

## Интеграция с планировщиком задач Windows

Для автоматического запуска мониторинга при старте системы:

1. Откройте "Планировщик заданий" (Task Scheduler)
2. Создайте новое задание
3. Триггер: "При запуске компьютера"
4. Действие: Запустить программу
   - Программа: `powershell.exe`
   - Аргументы: `-ExecutionPolicy Bypass -File "E:\HttpServer\monitor-backend.ps1" -AutoRestart`
5. Сохраните задание

## Примечания

- Все скрипты должны запускаться из корневой директории проекта
- PowerShell скрипты требуют права выполнения (используйте `-ExecutionPolicy Bypass`)
- Batch скрипты работают в CMD, но могут быть запущены из PowerShell
- Мониторинг работает в фоновом режиме и не блокирует терминал

