# Исправление обработки ошибок подключения к бэкенду

## Проблема

При недоступности бэкенд сервера (когда он не запущен) фронтенд логировал ошибки как критические, что создавало излишний шум в логах.

**Ошибки**:
- `Error fetching normalization status: TypeError: fetch failed`
- `Error fetching counterparties normalization status: TypeError: fetch failed`
- `SSE fetch error (backend unavailable)`

## Решение

Улучшена обработка ошибок подключения в API роутах:

### 1. `/api/normalization/status/route.ts`

**Изменения**:
- ✅ Ошибки подключения (`ECONNREFUSED`, `fetch failed`) теперь логируются как **предупреждения** (`logger.warn`), а не как ошибки
- ✅ Добавлена структурированная обработка ошибок с использованием `logger` и `createApiContext`
- ✅ Возвращается статус `503 Service Unavailable` с понятным сообщением для пользователя
- ✅ Добавлена информация о `backendUrl` в ответе

**Поведение**:
- При недоступности бэкенда возвращается `503` с сообщением: "Не удалось подключиться к backend серверу. Убедитесь, что сервер запущен на порту 9999."
- Логируется как предупреждение с пометкой: "Backend server appears to be unavailable. This is expected if the server is not running."

### 2. `/api/counterparties/normalization/status/route.ts`

**Изменения**:
- ✅ Аналогичные улучшения обработки ошибок подключения
- ✅ Ошибки подключения логируются как предупреждения
- ✅ Возвращается статус `503` с понятным сообщением

### 3. `/api/monitoring/providers/stream/route.ts`

**Уже было исправлено ранее**:
- ✅ Ошибки подключения логируются с throttling (не более 1 раза в 30 секунд)
- ✅ Используется уровень `logger.warn` вместо `logger.error`
- ✅ Добавлена пометка: "Backend server appears to be unavailable. Will retry silently."

## Результат

1. ✅ Ошибки подключения к бэкенду больше не логируются как критические
2. ✅ Используется правильный уровень логирования (`warn` вместо `error`)
3. ✅ Пользователи получают понятные сообщения об ошибках
4. ✅ Уменьшен шум в логах при недоступности бэкенда

## Рекомендации

1. **Для разработки**: Бэкенд сервер должен быть запущен на `http://localhost:9999`
2. **Для продакшена**: Убедитесь, что переменная окружения `BACKEND_URL` настроена правильно
3. **Мониторинг**: Ошибки подключения теперь логируются как предупреждения, что позволяет легко отфильтровать их в системах мониторинга

## Тестирование

После исправлений:
- ✅ Ошибки подключения логируются как предупреждения
- ✅ API роуты возвращают статус `503` с понятными сообщениями
- ✅ Логи не перегружены критическими ошибками при недоступности бэкенда

