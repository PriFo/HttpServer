# Быстрое применение исправлений стабильности сервера

## Автоматические исправления

Следующие исправления применяются автоматически при следующем запуске сервера:

### 1. Таблица providers
✅ **Автоматически** - таблица создается при инициализации сервисной БД
- Никаких дополнительных действий не требуется
- При первом запуске после обновления таблица будет создана автоматически

### 2. Gin Release Mode
✅ **Автоматически** - режим release устанавливается по умолчанию
- По умолчанию сервер запускается в режиме release
- Для разработки можно установить: `export GIN_MODE=debug` (Linux/macOS) или `$env:GIN_MODE="debug"` (Windows PowerShell)

## Ручные исправления

### 3. Иерархия КПВЭД

Требует ручного вмешательства для исправления данных:

1. **Проверка проблемы:**
   ```bash
   sqlite3 service.db < database/kpved_diagnostics.sql
   ```
   Или откройте файл `database/kpved_diagnostics.sql` и выполните первый диагностический запрос вручную.

2. **Выбор решения:**
   - Если проблемных узлов немного - используйте **Решение 3** (создание недостающих узлов)
   - Если проблемных узлов много - используйте **Решение 1** (обновление на ближайшего родителя)
   - Если узлы должны быть корневыми - используйте **Решение 2** (установка parent_code = NULL)

3. **Применение исправления:**
   - Откройте `database/kpved_diagnostics.sql`
   - Найдите нужный раздел "РЕШЕНИЕ"
   - **ВАЖНО:** Проверьте запрос перед выполнением!
   - Выполните запрос в вашей БД

4. **Проверка:**
   Выполните валидационный запрос из конца файла `database/kpved_diagnostics.sql`

## Проверка исправлений

После запуска сервера проверьте логи:

1. ✅ **Нет ошибки** `no such table: providers`
2. ✅ **Нет предупреждения** `[GIN-debug] [WARNING] Running in "debug" mode`
3. ✅ **Сообщение** `Multi-provider client initialized with X active providers`

Если все три пункта выполнены - исправления применены успешно!

## Откат изменений

Если нужно откатить изменения:

1. **Gin Mode:** Установите `GIN_MODE=debug` для возврата к debug режиму
2. **Providers Table:** Таблица не удаляется автоматически, но можно удалить вручную:
   ```sql
   DROP TABLE IF EXISTS providers;
   ```
3. **KPVED:** Исправления данных в KPVED требуют ручного отката в зависимости от примененного решения

## Дополнительная информация

Подробная документация: `docs/SERVER_STABILITY_FIXES.md`

