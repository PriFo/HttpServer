# Следующие шаги рефакторинга

## Текущая ситуация

Создан базовый DI контейнер, но полная версия (`Container`) имеет много ошибок компиляции из-за сложности зависимостей. Создана упрощенная версия (`SimpleContainer`) для постепенного рефакторинга.

## Стратегия

### Фаза 1: Упрощенный контейнер ✅

- [x] Создан `SimpleContainer` с базовыми компонентами
- [x] Инициализация баз данных
- [x] Базовые сервисы (Normalization, Upload, Client, Database)
- [x] Базовые обработчики (Upload, Database)
- [x] Мониторинг

### Фаза 2: Постепенное добавление компонентов

1. **Исправить полный Container**
   - Создать адаптеры для интерфейсов
   - Исправить все сигнатуры функций
   - Добавить lazy initialization для опциональных компонентов

2. **Добавить недостающие сервисы в SimpleContainer**
   - QualityService
   - ClassificationService
   - SimilarityService
   - И другие по мере необходимости

3. **Добавить обработчики**
   - По одному, проверяя компиляцию после каждого

### Фаза 3: Вынос обработчиков по доменам

1. **Создать структуру для handlers**
   ```
   internal/api/handlers/
   ├── upload/
   ├── normalization/
   ├── quality/
   └── ...
   ```

2. **Перенести обработчики**
   - Начать с UploadHandler
   - Затем NormalizationHandler
   - И так далее

### Фаза 4: Domain модели и интерфейсы

1. **Создать интерфейсы сервисов**
   ```
   internal/domain/services/
   ├── upload_service.go
   ├── normalization_service.go
   └── ...
   ```

2. **Создать интерфейсы репозиториев**
   ```
   internal/domain/repositories/
   ├── upload_repository.go
   └── ...
   ```

## Рекомендации

1. **Использовать SimpleContainer** для начала работы
2. **Добавлять компоненты постепенно**, проверяя компиляцию
3. **Создавать адаптеры** для сложных зависимостей
4. **Документировать изменения** по мере продвижения

## Приоритеты

1. ✅ Создать работающий базовый контейнер
2. ⏳ Исправить полный Container или создать адаптеры
3. ⏳ Начать вынос обработчиков по доменам
4. ⏳ Создать domain интерфейсы

