# –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É Upload Domain

## –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: 2025-01-21

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Upload Domain –ø–æ Clean Architecture

### üìÅ –°–æ–∑–¥–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
internal/
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îî‚îÄ‚îÄ upload/
‚îÇ       ‚îú‚îÄ‚îÄ service.go                  # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å domain service
‚îÇ       ‚îú‚îÄ‚îÄ service_impl.go            # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è domain service
‚îÇ       ‚îú‚îÄ‚îÄ database_info_service.go   # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îÇ       ‚îî‚îÄ‚îÄ errors.go                  # Domain –æ—à–∏–±–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îî‚îÄ‚îÄ upload/
‚îÇ       ‚îî‚îÄ‚îÄ usecase.go                 # Application use cases
‚îÇ
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ upload/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ handler.go             # HTTP handlers
‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ       ‚îú‚îÄ‚îÄ upload_routes.go           # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è upload –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ router.go                  # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π Router
‚îÇ
‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ persistence/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ upload_repository.go      # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îî‚îÄ‚îÄ database_info_adapter.go   # –ê–¥–∞–ø—Ç–µ—Ä –∫ utils
‚îÇ
‚îî‚îÄ‚îÄ container/
    ‚îî‚îÄ‚îÄ upload_init.go                 # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è upload –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```

## üéØ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### Domain Layer
- ‚úÖ `Service` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `service` —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
- ‚úÖ `DatabaseInfoService` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞/–ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ Domain-specific –æ—à–∏–±–∫–∏

### Application Layer
- ‚úÖ `UseCase` –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã use cases —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

### Infrastructure Layer
- ‚úÖ `UploadRepository` - –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ `DatabaseInfoAdapter` - –∞–¥–∞–ø—Ç–µ—Ä –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º utils
- ‚úÖ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É domain –∏ database –º–æ–¥–µ–ª—è–º–∏

### Presentation Layer
- ‚úÖ HTTP handlers –¥–ª—è –≤—Å–µ—Ö upload endpoints:
  - `HandleHandshake` 
  - `HandleMetadata`
  - `HandleConstant`
  - `HandleCatalogMeta`
  - `HandleCatalogItem`
  - `HandleCatalogItems`
  - `HandleNomenclatureBatch`
  - `HandleComplete`
  - `HandleListUploads`
  - `HandleGetUpload`

### Routes & Router
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö upload –º–∞—Ä—à—Ä—É—Ç–æ–≤
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π Router –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ legacy endpoints

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### Dependency Injection
- –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤–Ω–µ–¥—Ä—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è –Ω–∏–∑–∫–æ–π —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏
- DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

### Clean Architecture
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤ (domain, application, infrastructure, presentation)
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–Ω—É—Ç—Ä—å (–∫ domain —Å–ª–æ—é)
- ‚úÖ Domain layer –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫

### DDD (Domain-Driven Design)
- ‚úÖ Bounded context –¥–ª—è upload domain
- ‚úÖ Aggregate Root (Upload entity)
- ‚úÖ Domain services –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- ‚úÖ Repository pattern –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏

## üìä –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è:
- ‚úÖ `internal/domain/upload`
- ‚úÖ `internal/application/upload`
- ‚úÖ `internal/infrastructure/persistence`
- ‚úÖ `internal/infrastructure/services`
- ‚úÖ `internal/api/handlers/upload`
- ‚úÖ `internal/api/routes`
- ‚úÖ `internal/container`

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- ‚úÖ `docs/REFACTORING_PLAN.md` - –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ `docs/REFACTORING_PROGRESS.md` - –ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ `docs/INTEGRATION_GUIDE.md` - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ `docs/INTEGRATION_EXAMPLE.md` - –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
1. ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã
2. ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
3. ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–Ω–µ–¥—Ä—è—é—Ç—Å—è
4. ‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
5. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

### –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ:
1. –î–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ container –≤ `server.go`
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã —á–µ—Ä–µ–∑ `routes.NewRouter()`
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å endpoints
4. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–æ–≤—ã–µ handlers

## üìà –ú–µ—Ç—Ä–∏–∫–∏

### –ö–æ–¥
- **–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ**: 11
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~1500+
- **–ü–∞–∫–µ—Ç–æ–≤**: 6
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤**: 3
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏–π**: 5

### –ö–∞—á–µ—Å—Ç–≤–æ
- ‚úÖ –ù–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–¥–∞—á–∏:
1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ server.go** - –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ handlers –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å–æ —Å—Ç–∞—Ä—ã–º–∏
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - unit –∏ integration —Ç–µ—Å—Ç—ã
3. **–î–æ—Ä–∞–±–æ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏ –∫–∞—Ç–∞–ª–æ–≥–æ–≤

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏:
1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ normalization domain
2. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ quality domain
3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ classification domain
4. –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å —É–¥–∞–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
2. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –ö–æ–¥ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –ø–æ —Å–ª–æ—è–º –∏ –¥–æ–º–µ–Ω–∞–º
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –¥–æ–º–µ–Ω—ã
4. **–ò–∑–æ–ª—è—Ü–∏—è**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º —Å–ª–æ–µ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –¥—Ä—É–≥–∏–µ
5. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

## üéì –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

- **Repository Pattern** - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
- **Service Layer** - –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- **Use Case Pattern** - –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
- **Adapter Pattern** - –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
- **Dependency Injection** - –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **Interface Segregation** - –¥–ª—è —á–µ—Ç–∫–∏—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ Upload Domain –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

